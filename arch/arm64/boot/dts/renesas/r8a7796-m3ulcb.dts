/*
 * Device Tree Source for the M3ULCB (R-Car Starter Kit Pro) board
 *
 * Copyright (C) 2016-2018 Renesas Electronics Corp.
 * Copyright (C) 2016 Cogent Embedded, Inc.
 *
 * This file is licensed under the terms of the GNU General Public License
 * version 2.  This program is licensed "as is" without any warranty of any
 * kind, whether express or implied.
 */

/dts-v1/;
#include "r8a7796.dtsi"
#include "ulcb.dtsi"

/ {
	model = "Renesas M3ULCB board based on r8a7796";
	compatible = "renesas,m3ulcb", "renesas,r8a7796";

	cpus {
		idle-states {
			/delete-node/ cpu-sleep-1;
		};
	};

	memory@48000000 {
		device_type = "memory";
		/* first 128MB is reserved for secure area. */
		reg = <0x0 0x48000000 0x0 0x38000000>;
	};

	memory@600000000 {
		device_type = "memory";
		reg = <0x6 0x00000000 0x0 0x40000000>;
	};

	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		/* device specific region for Lossy Decompression */
		lossy_decompress: linux,lossy_decompress {
			no-map;
			reg = <0x00000000 0x54000000 0x0 0x03000000>;
		};

		/* global autoconfigured region for contiguous allocations */
		linux,cma {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x57000000 0x0 0x19000000>;
			linux,cma-default;
		};

		/* device specific region for contiguous allocations */
		mmp_reserved: linux,multimedia {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x00000000 0x70000000 0x0 0x10000000>;
		};
	};

	mmngr {
		compatible = "renesas,mmngr";
		memory-region = <&mmp_reserved>, <&lossy_decompress>;
	};

	mmngrbuf {
		compatible = "renesas,mmngrbuf";
	};

	vspm_if {
		compatible = "renesas,vspm_if";
	};

	versaclock5_out3: versaclk-3 {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		/* Initial value of versaclock out3 */
		clock-frequency = <33000000>;
	};
};

&a53_0 {
	/delete-property/ cpu-idle-states;
};

&a53_1 {
	/delete-property/ cpu-idle-states;
};

&a53_2 {
	/delete-property/ cpu-idle-states;
};

&a53_3 {
	/delete-property/ cpu-idle-states;
};

&du {
	clocks = <&cpg CPG_MOD 724>,
		 <&cpg CPG_MOD 723>,
		 <&cpg CPG_MOD 722>,
		 <&cpg CPG_MOD 727>,
		 <&versaclock5 1>,
		 <&versaclock5_out3>,
		 <&versaclock5 2>;
	clock-names = "du.0", "du.1", "du.2", "lvds.0",
		      "dclkin.0", "dclkin.1", "dclkin.2";
};

&vspb {
	status = "okay";
};

&vspi0 {
	status = "okay";
};


&i2c4 {
	status = "okay";
	clock-frequency = <400000>;

	ov106xx@0 {
		compatible = "ovti,ov106xx";
		reg = <0x10>;

		port@0 {
			customer_in0: endpoint {
				clock-lanes = <0>;
				data-lanes = <1 2 3 4>;
				remote-endpoint = <&vin0ep0>;
			};
		};
		port@1 {
			ov106xx_ti964_des0ep0: endpoint@1 {
				remote-endpoint = <&ti964_des0ep0>;
			};
		};
	};

//	ov106xx@1 {
//		compatible = "ovti,ov106xx";
//		reg = <0x61>;
//
//		port@0 {
//			customer_in1: endpoint {
//				clock-lanes = <0>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&vin1ep0>;
//			};
//		};
//		port@1 {
//			ov106xx_ti964_des0ep1: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep1>;
//			};
//		};
//	};
//
//	ov106xx@2 {
//		compatible = "ovti,ov106xx";
//		reg = <0x62>;
//
//		port@0 {
//			customer_in2: endpoint {
//				clock-lanes = <0>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&vin2ep0>;
//			};
//		};
//		port@1 {
//			ov106xx_ti964_des0ep2: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep2>;
//			};
//		};
//	};
//
//	ov106xx@3 {
//		compatible = "ovti,ov106xx";
//		reg = <0x63>;
//
//		port@0 {
//			customer_in3: endpoint {
//				clock-lanes = <0>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&vin3ep0>;
//			};
//		};
//		port@1 {
//			ov106xx_ti964_des0ep3: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep3>;
//			};
//		};
//	};


	/* DS90UB9x4 @ 0x3a */
	ti964@0 {
		compatible = "ti,ti9x4";
		reg = <0x36>;
		ti,links = <4>;
		ti,lanes = <4>;
		ti,forwarding-mode = "round-robin";
		ti,cable-mode = "coax";
        ti,ser_id = <0x30>;
        ti,hsync = <1280>;
        ti,vsync = <720>;

//		POC0-gpios = <&gpio_exp_a_5c 8 GPIO_ACTIVE_HIGH>;
//		POC1-gpios = <&gpio_exp_a_5c 9 GPIO_ACTIVE_HIGH>;
//		POC2-gpios = <&gpio_exp_a_5c 10 GPIO_ACTIVE_HIGH>;
//		POC3-gpios = <&gpio_exp_a_5c 11 GPIO_ACTIVE_HIGH>;

		port@0 {
			ti964_des0ep0: endpoint@0 {
				ti9x3-addr = <0x0c>;
				dvp-order = <0>;
				remote-endpoint = <&customer_in0>;
			};
//			ti964_des0ep1: endpoint@1 {
//				ti9x3-addr = <0x0d>;
//				dvp-order = <0>;
//				remote-endpoint = <&customer_in1>;
//			};
//			ti964_des0ep2: endpoint@2 {
//				ti9x3-addr = <0x0e>;
//				dvp-order = <0>;
//				remote-endpoint = <&customer_in2>;
//			};
//			ti964_des0ep3: endpoint@3 {
//				ti9x3-addr = <0x0f>;
//				dvp-order = <0>;
//				remote-endpoint = <&customer_in3>;
//			};
		};
		port@1 {
			ti964_csi0ep0: endpoint {
//				csi-rate = <1450>;
				remote-endpoint = <&csi2_40_ep>;
			};
		};
	};
};

&csi40 {
	status = "okay";

	virtual,channel {
		csi2_vc0 {
			data,type = "ycbcr422";
			receive,vc = <0>;
		};
//		csi2_vc1 {
//			data,type = "ycbcr422";
//			receive,vc = <1>;
//		};
//		csi2_vc2 {
//			data,type = "ycbcr422";
//			receive,vc = <2>;
//		};
//		csi2_vc3 {
//			data,type = "ycbcr422";
//			receive,vc = <3>;
//		};
	};

	port {
		#address-cells = <1>;
		#size-cells = <0>;

		csi2_40_ep: endpoint {
			clock-lanes = <0>;
			data-lanes = <1 2 3 4>;
			csi-rate = <600>;
//			csi-rate = <300>;
		};
	};
};

&vin0 {
	status = "okay";

	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			vin0ep0: endpoint {
				csi,select = "csi40";
				virtual,channel = <0>;
				data-lanes = <1 2 3 4>;
				remote-endpoint = <&customer_in0>;
			};
		};
		port@1 {
			csi0ep0: endpoint {
				remote-endpoint = <&csi2_40_ep>;
			};
		};
		port@2 {
			vin0_ti964_des0ep0: endpoint@1 {
				remote-endpoint = <&ti964_des0ep0>;
			};
		};
	};
};

//&vin1 {
//	status = "okay";
//
//	ports {
//		#address-cells = <1>;
//		#size-cells = <0>;
//
//		port@0 {
//			vin1ep0: endpoint {
//				csi,select = "csi40";
//				virtual,channel = <1>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&customer_in1>;
//			};
//		};
//		port@1 {
//			csi0ep1: endpoint {
//				remote-endpoint = <&csi2_40_ep>;
//			};
//		};
//		port@2 {
//			vin1_ti964_des0ep1: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep1>;
//			};
//		};
//	};
//};

//&vin2 {
//	status = "okay";
//
//	ports {
//		#address-cells = <1>;
//		#size-cells = <0>;
//
//		port@0 {
//			vin2ep0: endpoint {
//				csi,select = "csi40";
//				virtual,channel = <2>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&customer_in2>;
//			};
//		};
//		port@1 {
//			csi0ep2: endpoint {
//				remote-endpoint = <&csi2_40_ep>;
//			};
//		};
//		port@2 {
//			vin2_ti964_des0ep2: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep2>;
//			};
//		};
//	};
//};

//&vin3 {
//	status = "okay";
//
//	ports {
//		#address-cells = <1>;
//		#size-cells = <0>;
//
//		port@0 {
//			vin3ep0: endpoint {
//				csi,select = "csi40";
//				virtual,channel = <3>;
//				data-lanes = <1 2 3 4>;
//				remote-endpoint = <&customer_in3>;
//			};
//		};
//		port@1 {
//			csi0ep3: endpoint {
//				remote-endpoint = <&csi2_40_ep>;
//			};
//		};
//		port@2 {
//			vin3_ti964_des0ep3: endpoint@1 {
//				remote-endpoint = <&ti964_des0ep3>;
//			};
//		};
//	};
//};
